<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

    <title>5 Dots Connect Game - Earn9</title>
    {% load static %}
    <script src="https://cdn.tailwindcss.com"></script> 
    <script src="https://unpkg.com/htmx.org@2.0.4" integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx-ext-ws@2.0.2" integrity="sha384-vuKxTKv5TX/b3lLzDKP2U363sOAoRo5wSvzzc3LJsbaQRSBSS+3rKKHcOx5J8doU" crossorigin="anonymous"></script> 

    <!-- <link rel="stylesheet" href="{% static 'connectDots/css/styles.css' %}">      -->
    {% include 'layout/HomePage/Header_Home.html' %}

<style>    
        .header-glow::after {
            content: '';
            position: absolute;
            inset: -5px;
            background: linear-gradient(45deg, 
                rgba(59,130,246,0.2) 0%,
                rgba(99,102,241,0.1) 50%,
                rgba(59,130,246,0.2) 100%
            );
            border-radius: 12px;
            z-index: -1;
        } 
        
        /* Cyberpunk Timer */
        .timer-container {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59,130,246,0.3);
            box-shadow: 0 0 20px rgba(59,130,246,0.2);
            position: relative;
            overflow: hidden;
            font-size: 1.5rem; 
        }

        .timer-container::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, 
                transparent 0%,
                rgba(59,130,246,0.1) 50%,
                transparent 100%
            );
            animation: scanline 6s linear infinite;
            /* font-size: medium; */
            font-size: 1.5rem; 
        }

        #timer {
            background: linear-gradient(45deg, #8b5cf6, #3b82f6);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 0 10px rgba(59,130,246,0.5);
            font-family: 'Orbitron', sans-serif;
        }
  
        .particles {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
        }
 
        @media (max-width: 768px) { 
            #timer {
                font-size: 0.7rem; 
            }

            .timer-container h1 {
                font-size: 1.3rem; 
            }
 
        }  
        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .bg-gray-800.p-6.rounded-xl.neon-box {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
            
            .grid.grid-cols-2.md\:grid-cols-4 {
                flex: 2;
                justify-content: flex-end;
            }
            
            .coin-btn {
                min-width: 65px;
                min-height: 40px;
                flex: none;
            }
            
            .flex.flex-col.md\:flex-row {
                flex: 1;
                margin-bottom: 0;
            }
        }

        @media (max-width: 480px) {
            .flex.flex-col.md\:flex-row {
                flex-direction: column;
                /* gap: 0.75rem; */
            }
            
            #confirm-bet-btn {
                width: fit-content;
                font-size: small;
            }
            
            .coin-btn {
                min-width: calc(10% - 0.25rem);
            }
        }

        /* Responsive Adjustments */
        
        @media (max-width: 320px) {

            
            .bg-gray-800.p-6.rounded-xl.neon-box {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
            
            .grid.grid-cols-2.md\:grid-cols-4 {
                flex: 2;
                justify-content: flex-end;
            }
            
            
            .flex.flex-col.md\:flex-row {
                flex: 1;
                margin-bottom: 0;
            }
            .flex.flex-col.md\:flex-row {
                flex-direction: column;
                gap: 0.45rem;
            }
            
            #confirm-bet-btn {
                width: fit-content;
                font-size: small;
            }
            
            .coin-btn {
                min-width: calc(5% - 0.15rem);
                /* padding: 0.25rem; */
                font-size: 0.6rem;
            }
        }
   
        @keyframes winnerFlash {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            30% {
                opacity: 1;
                transform: scale(1.2);
            }
            60% {
                opacity: 1;
                transform: scale(1.6);
            }
            100% {
                opacity: 0;
                transform: scale(2);
            }
        }

        .winner-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            color: rgb(191, 163, 3);
            text-shadow: 0 0 10px rgb(209, 180, 14);
            animation: winnerFlash 2s ease-out forwards;
            /* z-index: 50; */
            pointer-events: none;
        }


        @keyframes winnerFlashCard {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            30% {
                opacity: 1;
                transform: scale(1.2);
            }
            60% {
                opacity: 1;
                transform: scale(1.6);
            }
            100% {
                opacity: 0;
                transform: scale(2);
            }
        } 
        .card {
            perspective: 1000px;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card-inner.flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            /* backface-visibility: hidden; */
        }

        .card-front {
            transform: rotateY(0deg);
        }

        .card-back {
            transform: rotateY(180deg);
        }

        .card:hover {
            transform: scale(1.02);
            transition: transform 0.2s ease-in-out;
        }

        .neon-glow {
        filter: drop-shadow(0 0 2px #fff)
                drop-shadow(0 0 6px #0ff)
                drop-shadow(0 0 12px yellow);
        transition: filter 0.4s ease;
        }

        #players-group {
            max-width: 100%;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
      
        
        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            10% {
                opacity: 1;
                transform: scale(1);
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: scale(1.1);
            }
        }

        .animate-fade-in-out {
            animation: fadeInOut 2s ease-in-out forwards;
            z-index: 50;
            }
        .blur {
            filter: blur(5px);
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
</style>
 
<style>
    body {
        background-color: #e9e7fd;
    }

    /* Main Container */

    #main-container {

        align-items: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 100vh;

    }

    /* Player Details */

    #player {

        background-color: #d5deff;
        border: 8px solid #4f3ff0;
        border-radius: 10px;
        margin-top: 50px;
        padding: 20px;
        width: 550px;

    }

    #player-type {

        color: #4f3ff0;
        font-family: "Poppins";
        letter-spacing: 5px;
        text-align: center;
        text-transform: uppercase;

    } 
    #grid {

        background-color: #4f3ff0;
        border: 3.5px solid #d5deff;
        border-radius: 8px;
        box-shadow: 2px 3px 7px grey;
        margin-top: 50px;
        max-width: 600px;
        padding: 3px;

    } 
    .row {

        display: flex;

    } 
    .col {

        align-items: center;
        background-color: #d5deff;
        border: 1px solid  #4f3ff0;
        border-radius: 5px;
        display: flex;
        justify-content: center;
        height: 75px;
        margin: 5px;
        width:  75px;

    }
 

    #reset-btn {

        background-color: transparent;
        border: 2px solid #4f3ff0;
        border-radius: 5px;
        color: #4f3ff0;
        font-family: "Poppins";
        font-size: 1.5rem;
        margin: 50px 0;
        padding: 10px 40px;
        text-transform: uppercase;
        transition: 0.7s;

    }

    #reset-btn:hover {

        background-color: #4f3ff0;
        color: #d5deff;
        cursor: pointer;
        transition: 0.7s;

    }

    /* Player - 1 Buttons */
    .btn-player-1::after, 
    .btn-player-2::after {
        content: '';
        display: block;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    /* Buttons */
  
    .btn {
        position: relative;
        background-color: transparent !important;
        border: none !important;
        color: transparent;
        height: 100%;
        padding: 0;
        width: 100%;
    }

    .btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: none;
    }

    .btn-player-1::after {
        background-color: #34c471;
        display: block;
    }

    .btn-player-2::after {
        background-color: #df3670;
        display: block;
    }

    #turn-timer {
        font-family: "Poppins";
        font-size: 1.2rem;
        text-align: center;
        margin-top: 5px;
        color: #4f3ff0;
        font-weight: bold;
    }
    /* Media Queries */

    @media (max-width: 800px) {
        #grid {
            width: 500px;
        }

        .col {
            height: 62px;
            margin: 4px;
            width: 62px;
        }

        #player {
            width: 450px;
        }

        #reset-btn {
            font-size: 1.2rem;
        }

        .btn-player-1 {
            height: 40px;
            width: 40px;
        }

        .btn-player-2 {
            height: 40px;
            width: 40px;
        }
    }

    @media (max-width: 550px) {
        #grid {
            width: 450px;
        }

        .col {
            height: 50px;
            margin: 3px;
            width: 50px;
        }

        #player {
            width: 350px;
        }

        #reset-btn {
            font-size: 1rem;
        }

        .btn-player-1 {
            height: 30px;
            width: 30px;
        }

        .btn-player-2 {
            height: 30px;
            width: 30px;
        }
    }

    @media (max-width:  450px) {
        #grid {
            width: 95%;
        }

        .col {
            height: 40px;
            margin: 2px;
        }

        #player {
            align-items: center;
            display: flex;
            border-width: 5px;
            justify-content: center;
            height: 30px;
            width: 78%;
        }

        #player-type {
            font-size: 1.2rem;
        }

        #reset-btn {
            font-size: 0.8rem;
        }

        .btn-player-1 {
            height: 20px;
            width: 20px;
        }

        .btn-player-2 {
            height: 20px;
            width: 20px;
        }
    } 
</style>


<style>
    :root {
        --neon-blue: #00f3ff;
        --neon-pink: #ff00ea;
        --neon-purple: #8a2be2;
        --dark-bg: #0a0a1a;
        --card-bg: rgba(16, 16, 36, 0.8);
        --grid-bg: rgba(30, 30, 60, 0.6);
        --player-1-color: #00f3ff;
        --player-2-color: #ff00ea;
        --glow-blue: 0 0 10px rgba(0, 243, 255, 0.7), 0 0 20px rgba(0, 243, 255, 0.5), 0 0 30px rgba(0, 243, 255, 0.3);
        --glow-pink: 0 0 10px rgba(255, 0, 234, 0.7), 0 0 20px rgba(255, 0, 234, 0.5), 0 0 30px rgba(255, 0, 234, 0.3);
        --glow-purple: 0 0 10px rgba(138, 43, 226, 0.7), 0 0 20px rgba(138, 43, 226, 0.5), 0 0 30px rgba(138, 43, 226, 0.3);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(135deg, #0a0a1a, #1a1a3a, #0a0a1a);
        color: white;
        font-family: 'Poppins', sans-serif;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
    }

    /* Holographic background elements */
    body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 30%, rgba(0, 243, 255, 0.1) 0%, transparent 40%),
            radial-gradient(circle at 80% 70%, rgba(255, 0, 234, 0.1) 0%, transparent 40%);
        pointer-events: none;
        z-index: -1;
    }

    .game-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
        z-index: 1;
    }

    .game-header {
        text-align: center;
        padding: 20px 0;
        margin-bottom: 20px;
    }

    .game-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: var(--glow-purple);
        margin-bottom: 5px;
        animation: pulse 2s infinite alternate;
    }

    @keyframes pulse {
        0% { text-shadow: 0 0 5px rgba(138, 43, 226, 0.7); }
        100% { text-shadow: 0 0 20px rgba(138, 43, 226, 0.9), 0 0 30px rgba(138, 43, 226, 0.7); }
    } 

    .game-content {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 30px;
        margin-top: 20px;
    }

    .player-info-container {
        flex: 1;
        min-width: 300px;
        max-width: 400px;
        display: flex;
        flex-direction: column;
        gap: 25px;
    }

    .player-card {
        background: var(--card-bg);
        border: 2px solid var(--neon-purple);
        border-radius: 50px;
        padding: 10px;
        box-shadow: var(--glow-purple);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        opacity: 0.6;
        transform: scale(0.95);
    }

    .player-card.active {
        opacity: 1;
        transform: scale(1);
        border-color: var(--neon-blue);
        box-shadow: var(--glow-blue);
    }

    .player-card.player-2.active {
        border-color: var(--neon-pink);
        box-shadow: var(--glow-pink);
    }

    .player-card::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(138, 43, 226, 0.1), transparent);
        transform: rotate(45deg);
        pointer-events: none;
    }

    .player-profile {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
    }

    .player-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(45deg, var(--neon-purple), var(--neon-blue));
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Orbitron', sans-serif;
        font-size: 1.5rem;
        box-shadow: 0 0 10px rgba(138, 43, 226, 0.7);
    }

    .player-2 .player-avatar {
        background: linear-gradient(45deg, var(--neon-purple), var(--neon-pink));
    }

    .player-info {
        flex: 1;
    }

    .player-name {
        font-family: 'Orbitron', sans-serif;
        font-size: 1rem;
        color: var(--neon-blue);
        margin-bottom: 5px;
        text-shadow: 0 0 5px rgba(0, 243, 255, 0.7);
    }

    .player-2 .player-name {
        color: var(--neon-pink);
        text-shadow: 0 0 5px rgba(255, 0, 234, 0.7);
    }

    .player-stats {
        display: flex;
        justify-content: space-between;
        font-size: 1rem;
    }

    .player-moves {
        color: #aaa;
    }

    .player-moves span {
        color: white;
        font-weight: bold;
    }

    .player-turn-timer {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.4rem;
        text-align: center;
        color: var(--neon-blue);
        margin-top: 15px;
        text-shadow: 0 0 5px rgba(0, 243, 255, 0.7);
    }

    .player-2 .player-turn-timer {
        color: var(--neon-pink);
        text-shadow: 0 0 5px rgba(255, 0, 234, 0.7);
    }

    .grid-container {
        flex: 2;
        min-width: 300px;
        max-width: 700px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    #grid {
        background: var(--grid-bg);
        border: 2px solid var(--neon-purple);
        border-radius: 10px;
        padding: 8px;
        box-shadow: var(--glow-purple);
        display: inline-block;
        margin: 0 auto;
    }

    .row {
        display: flex;
    }

    .col {
        position: relative;
        background: rgba(20, 20, 40, 0.8);
        border: 1px solid rgba(138, 43, 226, 0.3);
        border-radius: 8px;
        margin: 5px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.2s ease;
        overflow: hidden;
        width: 70px;
        height: 70px;
    }

    .col::before {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, transparent 60%, rgba(138, 43, 226, 0.1) 100%);
        pointer-events: none;
    }

    .col:hover:not(.taken) {
        transform: scale(1.05);
        box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
        z-index: 2;
    }

    .btn {
        width: 100%;
        height: 100%;
        background: transparent;
        border: none;
        cursor: pointer;
        position: relative;
        z-index: 2;
    }

    .btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-radius: 50%;
        display: none;
        width: 50px;
        height: 50px;
        z-index: 3;
    }

    .btn-player-1::after {
        background-color: var(--player-1-color);
        box-shadow: var(--glow-blue);
        display: block;
    }

    .btn-player-2::after {
        background-color: var(--player-2-color);
        box-shadow: var(--glow-pink);
        display: block;
    }

    .controls {
        text-align: center;
        margin-top: 30px;
        padding: 0 20px;
        width: 100%;
    }

    #reset-btn {
        background: linear-gradient(45deg, var(--neon-purple), var(--neon-blue));
        border: none;
        border-radius: 50px;
        color: white;
        font-family: 'Orbitron', sans-serif;
        font-size: 1.4rem;
        padding: 15px 50px;
        text-transform: uppercase;
        letter-spacing: 2px;
        cursor: pointer;
        box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    #reset-btn::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transform: rotate(45deg);
        transition: all 0.5s ease;
    }

    #reset-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 0 25px rgba(138, 43, 226, 0.8), 0 0 40px rgba(0, 243, 255, 0.5);
    }

    #reset-btn:active {
        transform: translateY(1px);
        box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
    }

    .mobile-controls {
        display: none;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
    }

    .mobile-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--card-bg);
        border: 1px solid var(--neon-purple);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        color: var(--neon-blue);
        box-shadow: var(--glow-purple);
    }

    /* Holographic effects for grid cells */
    .hologram {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.05) 50%, transparent 60%);
        pointer-events: none;
        opacity: 0.7;
        animation: hologramMove 3s infinite linear;
        z-index: 1;
    }

    @keyframes hologramMove {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    /* Responsive adjustments */
    @media (max-width: 900px) {
        .game-content {
            flex-direction: column;
            align-items: center;
        }
        
        .player-info-container, .grid-container {
            width: 100%;
            max-width: 600px;
        }
        
        .col {
            width: 50px;
            height: 50px;
        }
        
        .btn::after {
            width: 35px;
            height: 35px;
        }
    }

    @media (max-width: 600px) {
        /* .game-title {
            font-size: 2rem;
        }
          
        #timer {
            font-size: 1.0rem;
        }
         */
        .player-name {
            font-size: 0.9rem;
        }
        
        .player-turn-timer {
            font-size: 1rem;
        }
        
        .col {
            width: 40px;
            height: 40px;
            margin: 3px;
        }
        
        .btn::after {
            width: 30px;
            height: 30px;
        }
        
        #reset-btn {
            font-size: 1.2rem;
            padding: 12px 40px;
        }
        
        .player-avatar {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }
        
        .mobile-controls {
            display: flex;
        }
    }

    @media (max-width: 400px) {
        .col {
            width: 35px;
            height: 35px;
            margin: 2px;
        }
        
        .btn::after {
            width: 25px;
            height: 25px;
        }
        
        #reset-btn {
            font-size: 1rem;
            padding: 10px 30px;
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }
    }

    /* Victory Modal */
    #victory-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background: linear-gradient(135deg, #1a1a3a, #0a0a1a);
        border: 2px solid var(--neon-purple);
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        max-width: 90%;
        width: 500px;
        box-shadow: 0 0 50px rgba(138, 43, 226, 0.7);
        position: relative;
        overflow: hidden;
    }

    .modal-content::before {
        content: "";
        position: absolute;
        top: -10px;
        left: -10px;
        right: -10px;
        bottom: -10px;
        background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink), var(--neon-purple));
        z-index: -1;
        border-radius: 25px;
        animation: rotate 4s linear infinite;
    }

    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .modal-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 2.5rem;
        margin-bottom: 20px;
        background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }

    .winner {
        font-size: 3rem;
        margin: 20px 0;
        text-shadow: 0 0 15px var(--neon-blue), 0 0 25px var(--neon-blue);
    }

    .prize {
        font-size: 1.8rem;
        color: gold;
        margin: 15px 0;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
    }

    .modal-btn {
        background: linear-gradient(45deg, var(--neon-purple), var(--neon-blue));
        border: none;
        border-radius: 50px;
        color: white;
        font-family: 'Orbitron', sans-serif;
        font-size: 1.2rem;
        padding: 12px 40px;
        margin-top: 30px;
        cursor: pointer;
        box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
        transition: all 0.3s ease;
    }

    .modal-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 0 25px rgba(138, 43, 226, 0.8);
    }
</style>

</head>  

<body>  
        
    <div class="game-container"> 
        <div class="flex flex-col md:flex-row justify-between align-items justify-center items-center mb-2 gap-1 neon-border">
            <div class="flex items-center space-x-2 header-glow inline-block rounded-full timer-container">
                <h1 class="text-2xl md:text-3xl font-bold text-white">âš¡ 5 DOT CONNECT 
                    <span id="timer" class="text-2xl md:text-3xl font-bold text-white"> 2:00 </span>   
                âš¡</h1>
            </div>
        </div>
        
        <div id="result-announcement" class="fixed inset-0 pointer-events-none z-50"></div>
        
        <div class="player-info-container">
            <div class="flex"> 
                <div id="player-1-card" class="player-card player-1 active flex-col">
                    <div class="player-profile">
                        <div class="player-avatar">P1</div>
                        <div class="player-info">
                            <div class="player-name" id="player-type-1">Player 1</div>
                            <div class="player-stats">
                                <div class="player-moves">Moves: <span id="player1-moves">0</span></div>
                            </div>
                        </div>
                    </div>
                    <div id="player1-turn-timer" class="player-turn-timer">Turn: 5s</div>
                </div>
                
                <div id="player-2-card" class="player-card player-2 flex-col">
                    <div class="player-profile">
                        <div class="player-avatar">P2</div>
                        <div class="player-info">
                            <div class="player-name" id="player-type-2">Player 2</div>
                            <div class="player-stats">
                                <div class="player-moves">Moves: <span id="player2-moves">0</span></div>
                            </div>
                        </div>
                    </div>
                    <div id="player2-turn-timer" class="player-turn-timer">Turn: 5s</div>
                </div>
            </div>
        </div>
        
        <div class="game-content">  
            <div class="grid-container">
                <div id="grid">
                    <div class="row">
                        <div class="col"><button class="btn btn-1"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-2"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-3"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-4"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-5"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-6"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-7"></button><div class="hologram"></div></div>
                    </div>
                    <div class="row">
                        <div class="col"><button class="btn btn-8"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-9"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-10"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-11"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-12"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-13"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-14"></button><div class="hologram"></div></div>
                    </div>
                    <div class="row">
                        <div class="col"><button class="btn btn-15"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-16"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-17"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-18"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-19"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-20"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-21"></button><div class="hologram"></div></div>
                    </div>
                    <div class="row">
                        <div class="col"><button class="btn btn-22"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-23"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-24"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-25"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-26"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-27"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-28"></button><div class="hologram"></div></div>
                    </div>
                    <div class="row">
                        <div class="col"><button class="btn btn-29"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-30"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-31"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-32"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-33"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-34"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-35"></button><div class="hologram"></div></div>
                    </div>
                    <div class="row">
                        <div class="col"><button class="btn btn-36"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-37"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-38"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-39"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-40"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-41"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-42"></button><div class="hologram"></div></div>
                    </div> 
                    <div class="row">
                        <div class="col"><button class="btn btn-43"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-44"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-45"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-46"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-47"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-48"></button><div class="hologram"></div></div>
                        <div class="col"><button class="btn btn-49"></button><div class="hologram"></div></div>
                    </div>
                </div> 
                
            </div>
        </div>
        
    </div>
   
<script> 
    let socket; 
    let reconnectAttempts = 0;   
    let currentPlayer = null; 
    let playerAId = null;
    let playerBId = null;
    let isMyTurn = false;
    let mainTimerInterval = null;
    let turnTimerInterval = null;
    let isPlayerA = false;
    let player1Moves = 0;
    let player2Moves = 0;

    
    const player1Card = document.getElementById('player-1-card');
    const player2Card = document.getElementById('player-2-card');
    // const grid = document.getElementById('gird');
    const player1Timer = document.getElementById('player1-turn-timer');
    const player2Timer = document.getElementById('player2-turn-timer');
    const player1MovesElement = document.getElementById('player1-moves');
    const player2MovesElement = document.getElementById('player2-moves');

    const pathSegments = window.location.pathname.split('/');
    const game_id = pathSegments[4]; 
    const timerElement = document.getElementById('timer'); 
    const playerType1Element = document.getElementById('player-type-1');
    const playerType2Element = document.getElementById('player-type-2');
    const turnTimerElement = document.getElementById('turn-timer');
    const buttons = document.querySelectorAll('.btn');

    function initWebSocket() { 
        socket = new WebSocket(
            (window.location.protocol === 'https:' ? 'wss://' : 'ws://') + 
            window.location.host + `/ws/connect_dots_play/connectDot_session/${game_id}/`
        );
        
        socket.onopen = () => { 
            socket.send(JSON.stringify({action: 'sync_state'}));
        };

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            handleSocketMessage(data);
        };
        
        socket.onclose = (e) => {
            if(reconnectAttempts < 5) {
                setTimeout(() => {
                    reconnectAttempts++;
                    initWebSocket();
                }, Math.min(1000 * reconnectAttempts, 5000));
            }
        };
    }

    function handleSocketMessage(data) { 
        if (data.type === 'player_assignment') {
            isPlayerA = data.is_player_a; 
            return;
        }
         
        
        switch(data.type) {
        case 'game_state': 
            updateGameState(data);
            break;
        case 'move_made': 
            handleMoveMade(data);
            break; 
        case 'game.result': 
            handleResults(data.result);
            break;
        case 'turn_shifted': 
            handleTurnShifted(data);
            break;
        case 'timer_update': 
            updateTimers(data);
            break;
                
        }
    }

    function updateGridAndCardsColor(currentTurnPlayerToken) {
        const isPlayerATurn = currentTurnPlayerToken === playerAId;
         
        if (isPlayerATurn) {
            grid.style.borderColor = 'var(--neon-blue)';
            grid.style.boxShadow = '0 0 15px rgba(0, 243, 255, 0.7), 0 0 25px rgba(0, 243, 255, 0.5)';
        } else {
            grid.style.borderColor = 'var(--neon-pink)';
            grid.style.boxShadow = '0 0 15px rgba(255, 0, 234, 0.7), 0 0 25px rgba(255, 0, 234, 0.5)';
        }
        
        // Update player cards
        if (isPlayerATurn) {
            player1Card.style.borderColor = 'var(--neon-blue)';
            player1Card.style.boxShadow = 'var(--glow-blue)';
            player2Card.style.borderColor = 'var(--neon-purple)';
            player2Card.style.boxShadow = 'var(--glow-purple)';
        } else {
            player2Card.style.borderColor = 'var(--neon-pink)';
            player2Card.style.boxShadow = 'var(--glow-pink)';
            player1Card.style.borderColor = 'var(--neon-purple)';
            player1Card.style.boxShadow = 'var(--glow-purple)';
        }
    }

    function updateTimerDisplay(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
    }
    
    function handleTurnShifted(data) { 
        isMyTurn = data.new_turn === currentPlayer;  
            if (isMyTurn) {
                if (isPlayerA) {
                    player1Card.classList.add('active');
                    player2Card.classList.remove('active');
                    playerType1Element.textContent = isMyTurn ? "Your" : "Opponent's"; 
                    playerType2Element.textContent = isMyTurn ? "Opponent's" : "Your";  
                } else {
                    player2Card.classList.add('active');
                    player1Card.classList.remove('active'); 
                    playerType1Element.textContent = isMyTurn ? "Opponent's" :  "Your"; 
                    playerType2Element.textContent = isMyTurn ? "Your" : "Opponent's";
                }
            } else {
                if (isPlayerA) {
                    player2Card.classList.add('active');
                    player1Card.classList.remove('active'); 
                    playerType1Element.textContent = isMyTurn ? "Opponent's" :  "Your"; 
                    playerType2Element.textContent = isMyTurn ? "Your" : "Opponent's";
                } else {
                    player1Card.classList.add('active');
                    player2Card.classList.remove('active');
                    playerType1Element.textContent = isMyTurn ? "Your" : "Opponent's"; 
                    playerType2Element.textContent = isMyTurn ? "Opponent's" : "Your"; 
                    // playerType1Element.style.color = data.player_color;
                }
            }
             
        updateGridAndCardsColor(data.new_turn);
        buttons.forEach(btn => {
            const isTaken = btn.classList.contains('btn-player-1') || 
                            btn.classList.contains('btn-player-2');
            btn.disabled = isTaken || !isMyTurn;
        });
    }

    function updateGameState(data) {  
        if (!data) return; 
        
        isPlayerA = data.is_player_a; 
        data.grid_state.forEach((state, index) => {
            const button = document.querySelector(`.btn-${index+1}`);
            button.classList.remove('btn-player-1', 'btn-player-2');
            
            if(state === 1) {
                button.classList.add('btn-player-1');
                button.disabled = true;
            } else if(state === 2) {
                button.classList.add('btn-player-2');
                button.disabled = true;
            }
        });
          

        isMyTurn = data.current_player === currentPlayer; 
            
        if (isMyTurn) {
                if (isPlayerA) {
                    player1Card.classList.add('active');
                    player2Card.classList.remove('active');
                    playerType1Element.textContent = isMyTurn ? "Your" : "Opponent's"; 
                    playerType2Element.textContent = isMyTurn ? "Opponent's" : "Your";  
                } else {
                    player2Card.classList.add('active');
                    player1Card.classList.remove('active'); 
                    playerType1Element.textContent = isMyTurn ? "Opponent's" :  "Your"; 
                    playerType2Element.textContent = isMyTurn ? "Your" : "Opponent's";
                }
            } else {
                if (isPlayerA) {
                    player2Card.classList.add('active');
                    player1Card.classList.remove('active'); 
                    playerType1Element.textContent = isMyTurn ? "Opponent's" :  "Your"; 
                    playerType2Element.textContent = isMyTurn ? "Your" : "Opponent's";
                } else {
                    player1Card.classList.add('active');
                    player2Card.classList.remove('active');
                    playerType1Element.textContent = isMyTurn ? "Your" : "Opponent's"; 
                    playerType2Element.textContent = isMyTurn ? "Opponent's" : "Your"; 
                    // playerType1Element.style.color = data.player_color;
                }
            }
            
            
        player1Moves = data.grid_state.filter(state => state === 1).length;
        player2Moves = data.grid_state.filter(state => state === 2).length;
        player1MovesElement.textContent = player1Moves;
        player2MovesElement.textContent = player2Moves;
          

        updateGridAndCardsColor(data.current_player);
        buttons.forEach(btn => {
            const isTaken = btn.classList.contains('btn-player-1') || 
                            btn.classList.contains('btn-player-2');
            btn.disabled = isTaken || !isMyTurn;
        });
         
    }

 
    function updateTimer(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        timerElement.textContent = `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
    }

    function handleMoveMade(data) {
        const button = document.querySelector(`.btn-${data.button}`); 
            if (data.is_player_a) {
                button.classList.add('btn-player-1');  
                player1Moves++;
                player1MovesElement.textContent = player1Moves;
            } else {
                button.classList.add('btn-player-2'); 
                player2Moves++;
                player2MovesElement.textContent = player2Moves;
            }
             
        button.disabled = true;
    }

    function updateTimers(data) { 
        const mainTimer = updateTimerDisplay(data.timer);
        timerElement.textContent = mainTimer;
        
        player1Timer.textContent = `Turn: ${data.turn_timer}s`;
        player2Timer.textContent = `Turn: ${data.turn_timer}s`;
        
        buttons.forEach(btn => {
            const isTaken = btn.classList.contains('btn-player-1') || 
                            btn.classList.contains('btn-player-2');
            btn.disabled = isTaken || !isMyTurn;
        });
    }
  

    function handleResults(result) { 
        grid.style.display = 'none'; 
        if (window.resultsTimeout) clearTimeout(window.resultsTimeout);
        showVictoryModal(result);
    }

    function showVictoryModal(result) {
        const announcementContainer = document.getElementById("result-announcement");
        announcementContainer.innerHTML = "";
        
        const resultDiv = document.createElement('div');
        resultDiv.className = 'absolute text-center text-white font-bold animate-fade-in-out text-4xl p-4';
        resultDiv.style.top = "40%";
        resultDiv.style.left = "50%";
        resultDiv.style.transform = "translate(-50%, -50%)";
        
        const userCurrent = "{{ player.auth_token }}";
        const resultType = result.result_type;
        
        if (resultType.winner_a === userCurrent || resultType.winner_b === userCurrent) {
            resultDiv.innerHTML = `
                <div class="text-green-400 drop-shadow-lg">
                    ðŸŽ‰ YOU WIN! ðŸŽ‰ 
                </div>
                <div class="text-yellow-300 text-2xl mt-2">
                    ${resultType.prize} ðŸª™ 
                </div>
            `;
        }
        else if (resultType.loser_a === userCurrent || resultType.loser_b === userCurrent) {
            resultDiv.innerHTML = `
                <div class="text-red-500 drop-shadow-lg">
                    ðŸ’¥ YOU LOSE ðŸ’¥ 
                </div>
                <div class="text-yellow-300 text-2xl mt-2">
                    ${resultType.loser_a === userCurrent ? result.bits.player_a_bit : result.bits.player_b_bit} ðŸª™ 
                </div>
            `;
        }
        else {
            if (resultType.win_draw_a === userCurrent || resultType.win_draw_b === userCurrent) {
                resultDiv.innerHTML = `
                    <div class="text-blue-500 drop-shadow-lg">
                        ðŸŽ‰ Draw - Payback ðŸŽ‰
                    </div>
                    <div class="text-yellow-300 text-2xl mt-2"> 
                        +${resultType.win_draw_a === userCurrent ? result.bits.player_a_bit : result.bits.player_b_bit} ðŸª™ 
                    </div>
                `;
            }
            else {
                resultDiv.innerHTML = `
                    <div class="text-pink-500 drop-shadow-lg">
                        ðŸ’¥ Draw - Payout ðŸ’¥ 
                    </div>
                    <div class="text-yellow-300 text-2xl mt-2">  
                        -${resultType.loss_draw_a === userCurrent ? result.bits.player_a_bit : result.bits.player_b_bit} ðŸª™ 
                    </div>
                `;
            }
        }
        
        announcementContainer.appendChild(resultDiv);
        setTimeout(() => { 
            announcementContainer.innerHTML = "";
            window.location.href = '/Earn/page/connectDot_bit_page/';
        }, 5000); 
    }

    
    function updateTimers(data) {
        updateTimer(data.timer);
        if (isMyTurn) {
            player1Timer.textContent = `Turn: ${data.turn_timer}s`;
        }else{
            player2Timer.textContent = `Turn: ${data.turn_timer}s`;
        }
    } 
    
    function makeMove(btn, buttonNo) {
        if(socket.readyState === WebSocket.OPEN && isMyTurn) { 
            btn.disabled = true;
            socket.send(JSON.stringify({
                'action': 'make_move',
                'button': parseInt(buttonNo),
                'is_player_a': isPlayerA
            }));
        } else { 
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        initWebSocket();
        currentPlayer = "{{ player.auth_token }}"; 
        playerAId = "{{ game.player_a.auth_token }}";
        playerBId = "{{ game.player_b.auth_token }}";
            
            if (isPlayerA) {
                player1Card.classList.add('active');
                updateGridAndCardsColor(playerAId);
            } else {
                player2Card.classList.add('active');
                updateGridAndCardsColor(playerBId);
            }
        
        const buttons = document.querySelectorAll('.btn');
        buttons.forEach(btn => {
            const buttonNo = btn.classList[1].slice(4);
            btn.addEventListener("click", () => makeMove(btn, buttonNo));
        });
    });


    window.addEventListener('beforeunload', () => {
        clearInterval(mainTimerInterval);
        clearInterval(turnTimerInterval);
    });
</script> 

 
    {% include 'layout/HomePage/Footer_Home.html' %}
    {% load static %} 

  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script> 
  <!-- <script src="{% static 'connectDots/js/script.js' %}" ></script>  -->
  
</body>
</html>
